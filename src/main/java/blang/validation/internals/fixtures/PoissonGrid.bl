

import blang.types.Precision.Diagonal

model PoissonGrid {
  
  param Plate<Integer> plate
  
  random RealVar hyperParam
  random Plated<RealVar> latents
  random Plated<IntVar> observations
  
  laws {
    
    // Prior:
    hyperParam ~ Exponential(1.0)
    latents | Precision precision = new Diagonal(hyperParam, plate) ~ NormalField(precision)
    
    // Likelihood
    for (Index<Integer> index : plate.indices) {
      observations.get(index) | RealVar latent = latents.get(index) ~ Poisson(Math.exp(latent))
    }
    
  }
}